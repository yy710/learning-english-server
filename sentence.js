const data = [
    {
        id: 0,
        tag: ["Dinosaurs Before Dark"],
        title: null,
        text: ["“Help! A monster!” said Annie.“Yeah, sure,” said Jack. “A real monster in Frog Creek, Pennsylvania.”"],
        audio: {
            src: "https://www.all2key.cn/learning-english/audio/01intoWoods.mp3",
            startTime: 21,
            endTime: 31.5
        },
        image: "https://www.all2key.cn/learning-english/images/001.png",
        previousId: 0,
        nextId: 1
    },
    {
        id: 1,
        tag: ["Dinosaurs Before Dark"],
        title: null,
        text: ["“Run,Jack!” said Annie, She ran up the road."],
        audio: {
            src: "https://www.all2key.cn/learning-english/audio/01intoWoods.mp3",
            startTime: 32,
            endTime: 35
        },
        image: "https://www.all2key.cn/learning-english/images/001.png",
        previousId: 0,
        nextId: 2
    },
    {
        id: 2,
        tag: ["Dinosaurs Before Dark"],
        title: null,
        text: ["Oh, brother.This is what he got for spending time with his seven-year-old sister, Annie loved pretend stuff. But Jack was eight and a half. He liked real things."],
        audio: {
            src: "https://www.all2key.cn/learning-english/audio/01intoWoods.mp3",
            startTime: 35,
            endTime: 45
        },
        image: "https://www.all2key.cn/learning-english/images/001.png",
        previousId: 1,
        nextId: 0
    },
    {
        id: 3,
        tag: ["Dinosaurs Before Dark"],
        title: null,
        text: ["“Watch out, Jack! The monster’s coming! Race you!” “No, thanks,” said Jack."],
        audio: {
            src: "https://www.all2key.cn/learning-english/audio/01intoWoods.mp3",
            startTime: 45,
            endTime: 50
        },
        image: "https://www.all2key.cn/learning-english/images/001.png",
        previousId: 2,
        nextId: 4
    },
    {
        id: 4,
        tag: ["Dinosaurs Before Dark"],
        title: null,
        text: ["Annie raced alone into the woods. Jack looked at the sky. The sun was about to set."],
        audio: {
            src: "https://www.all2key.cn/learning-english/audio/01intoWoods.mp3",
            startTime: 50,
            endTime: 55
        },
        image: "https://www.all2key.cn/learning-english/images/001.png",
        previousId: 3,
        nextId: 5
    },
    {
        id: 5,
        tag: ["Dinosaurs Before Dark"],
        title: null,
        text: ["“Come on, Annie! It’s time to go home!” But Annie had disappeared. Jack waited. No Annie."],
        audio: {
            src: "https://www.all2key.cn/learning-english/audio/01intoWoods.mp3",
            startTime: 55,
            endTime: 60
        },
        image: "https://www.all2key.cn/learning-english/images/001.png",
        previousId: 4,
        nextId: 6
    },
    {
        id: 6,
        tag: ["Dinosaurs Before Dark"],
        title: null,
        text: ["“Annie!” he shouted again. “Jack! Jack! Come here!” Jack groaned. “This better be good,” he said."],
        audio: {
            src: "https://www.all2key.cn/learning-english/audio/01intoWoods.mp3",
            startTime: 55,
            endTime: 60
        },
        image: "https://www.all2key.cn/learning-english/images/001.png",
        previousId: 5,
        nextId: 7
    },
    {
        id: 7,
        tag: ["Dinosaurs Before Dark"],
        title: null,
        text: ["Jack left the road and headed into the woods. The trees were lit with a golden late-afternoon light."],
        audio: {
            src: "https://www.all2key.cn/learning-english/audio/01intoWoods.mp3",
            startTime: 55,
            endTime: 60
        },
        image: "https://www.all2key.cn/learning-english/images/001.png",
        previousId: 6,
        nextId: 8
    },
    {
        id: 8,
        tag: ["Dinosaurs Before Dark"],
        title: null,
        text: ["“Come here!” called Annie. There she was. Standing under a tall oak tree. “Look,” she said. She was pointing at a rope ladder."],
        audio: {
            src: "https://www.all2key.cn/learning-english/audio/01intoWoods.mp3",
            startTime: 55,
            endTime: 60
        },
        image: "https://www.all2key.cn/learning-english/images/001.png",
        previousId: 7,
        nextId: 9
    },
    {
        id: 9,
        tag: ["Dinosaurs Before Dark"],
        title: null,
        text: ["The longest rope ladder Jack had ever seen. “Wow,” he whispered. The ladder went all the way up to the top of the tree."],
        audio: {
            src: "https://www.all2key.cn/learning-english/audio/01intoWoods.mp3",
            startTime: 55,
            endTime: 60
        },
        image: "https://www.all2key.cn/learning-english/images/001.png",
        previousId: 8,
        nextId: 10
    },
    {
        id: 10,
        tag: ["Dinosaurs Before Dark"],
        title: null,
        text: ["There—at the top—was a tree house. It was tucked between two branches. “That must be the highest tree house in the world,” said Annie."],
        audio: {
            src: "https://www.all2key.cn/learning-english/audio/01intoWoods.mp3",
            startTime: 55,
            endTime: 60
        },
        image: "https://www.all2key.cn/learning-english/images/001.png",
        previousId: 9,
        nextId: 11
    },
    {
        id: 11,
        tag: ["Dinosaurs Before Dark"],
        title: null,
        text: ["“Who built it?” asked Jack. “I’ve never seen it before.” “I don’t know. But I’m going up,” said Annie. “No. We don’t know who it belongs to,” said Jack."],
        audio: {
            src: "https://www.all2key.cn/learning-english/audio/01intoWoods.mp3",
            startTime: 55,
            endTime: 60
        },
        image: "https://www.all2key.cn/learning-english/images/001.png",
        previousId: 10,
        nextId: 12
    },
    {
        id: 12,
        tag: ["Dinosaurs Before Dark"],
        title: null,
        text: ["“Just for a teeny minute,” said Annie. She started up the ladder. “Annie, “come back!” She kept climbing."],
        audio: {
            src: "https://www.all2key.cn/learning-english/audio/01intoWoods.mp3",
            startTime: 55,
            endTime: 60
        },
        image: "https://www.all2key.cn/learning-english/images/001.png",
        previousId: 11,
        nextId: 13
    },
    {
        id: 13,
        tag: ["Dinosaurs Before Dark"],
        title: null,
        text: ["Jack sighed. “Annie, it’s almost dark. We have to go home.” Annie disappeared inside the tree house."],
        audio: {
            src: "https://www.all2key.cn/learning-english/audio/01intoWoods.mp3",
            startTime: 55,
            endTime: 60
        },
        image: "https://www.all2key.cn/learning-english/images/001.png",
        previousId: 12,
        nextId: 14
    },
    {
        id: 14,
        tag: ["Dinosaurs Before Dark"],
        title: null,
        text: ["“An-nie!” Jack waited a moment. He was about to call again when Annie poked her head out of the tree house window."],
        audio: {
            src: "https://www.all2key.cn/learning-english/audio/01intoWoods.mp3",
            startTime: 55,
            endTime: 60
        },
        image: "https://www.all2key.cn/learning-english/images/001.png",
        previousId: 13,
        nextId: 15
    },
    {
        id: 15,
        tag: ["Dinosaurs Before Dark"],
        title: null,
        text: ["“Books!” she shouted. “What?” “It’s filled with books!” Oh, man! Jack loved books."],
        audio: {
            src: "https://www.all2key.cn/learning-english/audio/01intoWoods.mp3",
            startTime: 55,
            endTime: 60
        },
        image: "https://www.all2key.cn/learning-english/images/001.png",
        previousId: 14,
        nextId: 16
    },
    {
        id: 16,
        tag: ["Dinosaurs Before Dark"],
        title: null,
        text: ["He pushed his glasses into place. He gripped the sides of the rope ladder, and up he went."],
        audio: {
            src: "https://www.all2key.cn/learning-english/audio/01intoWoods.mp3",
            startTime: 55,
            endTime: 60
        },
        image: "https://www.all2key.cn/learning-english/images/001.png",
        previousId: 15,
        nextId: 0
    }
];

class Sentence {
    constructor() {
        //this.col = db.collection(colName);
    }

    getTitle() {
        data.forEach(item => {
            item.title = item.tag[0] + ' #' + item.id;
            item.text[1] = punctuation(item.text[0]
            );
        });
        return this;
    }

    getPrevious(currentId, num) {
        let s = data.slice(currentId - num + 1, currentId + 1);
        return s;
        /*
        this.col.findOne({tag: tag, nextId: 0}).next().then(doc=>{
            this.data = doc;
            this.data.text[1] = punctuation(this.data.text[0]);
            return this;
        });
        */
    }

    getNext(currentId, num) {
        let s = data.slice(currentId + 1, currentId + num + 1);
        return s;
    }

    getNear(currentId = 9, n1 = 1, n2 = 5) {
        let start = currentId - n1 <= 0 ? 0 : currentId - n1;
        let s = data.slice(start, currentId + n2);
        return s;
    }

    setNext(s) {
        this.data.nextId = s.data.id;
        s.data.lastId = this.data.id;
        this.save();
        return s;
    }

    save() {
        //return this.col.insertOne(this.data).then(r=>this).catch(console.log);
    }
}

module.exports = Sentence;

function punctuation(str) {
    return str.replace(/[\ |\~|\“|\”|\`|\!|\@|\#|\$|\%|\^|\&|\*|\(|\)|\-|\_|\+|\=|\||\\|\[|\]|\{|\}|\;|\:|\"|\'|\,|\<|\.|\>|\/|\?]/g, " ")//替换所有标点为空格
        .replace(/\s+/g, ' ')//合并多个空格
        .trim();//去除头尾空格
}

function ResetBlank() {
    var regEx = /\s+/g;
    return this.replace(regEx, ' ');
}